#!/usr/bin/env bash

function load_dotfiles() {
  local file
  local dotfiles_directory="${HOME}/dotfiles"
  local -a dotfiles=(
    "assets/paths"
    "bash/bash_prompt"
    "assets/exports"
    "assets/aliases"
    "assets/functions"
    "bash/bash_completions"
  )

  for file in "${dotfiles[@]}"; do
    if [[ -r "${dotfiles_directory}/${file}" ]]; then
      # shellcheck source=/dev/null
      source "${dotfiles_directory}/${file}"
    fi
  done
}

load_dotfiles
unset load_dotfiles

if command -v pyenv &> /dev/null; then
  eval "$(pyenv init --path)"
  eval "$(pyenv init -)"
  complete -o nospace -F _pyenv p
fi

# Commenting it out as this slows down the prompt by injecting the function
# _pyenv_virtualenv_hook to $PROMPT_COMMAND
# if command -v pyenv-virtualenv-init &> /dev/null; then
#   eval "$(pyenv virtualenv-init -)"
# fi

if command -v rbenv &> /dev/null; then
  eval "$(rbenv init -)"
fi

if [[ -f "/usr/local/opt/fzf/shell/key-bindings.bash" ]]; then
  source "/usr/local/opt/fzf/shell/key-bindings.bash"
fi

# Automatic history expansion (`!!`) when inserting a space.
#
# WARNING: Don't write this in `~/.inputrc`, it would prevent us from inserting
# spaces inside various programs such as python, etc.
bind '" ": magic-space'

# Shell Options
#
# Set/unset each option using the '-s' and '-u' flag.
# For help on each option: `man bash` and search `list.*shopt`

# Typing a directory name alone is enough to cd into it
shopt -s autocd

# Autocorrect typos in path names when using `cd`
shopt -s cdspell

# Lists the status of any stopped and running jobs before exiting an interactive
# shell. If any jobs are running, this causes the exit to be deferred until a
# second exit is attempted without an intervening command.
shopt -s checkjobs

# Automatically expand directory globs when completing
shopt -s direxpand

# Autocorrect directory typos when completing
shopt -s dirspell

# Enable the pattern `**` to match match all files and zero or more directories
# and subdirectories. `**/` matches any path to a folder.
shopt -s globstar

# Append to the Bash history file, rather than overwriting it.
shopt -s histappend

# After a history expansion, don't execute the resulting command immediately.
# Instead, write the expanded command into the readline editing  buffer for
# further modification.
shopt -s histverify

# Case-insensitive globbing (used in pathname expansion)
shopt -s nocaseglob
